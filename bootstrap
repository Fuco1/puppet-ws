# -*- mode: shell-script -*-
red=`tput setaf 1`
green=`tput setaf 2`
reset=`tput sgr0`

function install {
    echo -n "${green}$1..."
    shift
    $@ >/dev/null
    echo " done${reset}"
}

install "Updating apt sources" apt-get update

if ! which git >/dev/null; then
    install "Installing git" apt-get install -y git
fi

if ! which ruby >/dev/null; then
    install "Installing ruby stack" apt-get install -y ruby-bundler ruby-dev
fi

mkdir -p "$HOME/dev/puppet"
cd "$HOME/dev/puppet"

if test ! -d puppet-ws; then
    install "Clonning puppet-ws" git clone https://github.com/fuco1/puppet-ws.git
fi

cd puppet-ws
install "Install ruby bundle" bundle install --path vendor/bundle
install "Install puppet bundle" bundle exec librarian-puppet install

./run
